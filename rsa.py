# -*- coding: utf-8 -*-
"""rsa.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/10s6JiQy_oyUBtoH9U6P2A4XswN_qp9k7
"""

import streamlit as st
from sympy import randprime, mod_inverse

# ---- ãƒ˜ãƒ«ãƒ—é–¢æ•° ----
def text_to_numbers(text):
    # Aâ†’00, Bâ†’01, â€¦, Zâ†’25 ã«å¯¾å¿œ
    return ''.join(f"{ord(c)-65:02d}" for c in text)

def numbers_to_text(num_str):
    # 2æ¡ãšã¤åˆ†å‰²ã—ã¦é€†å¤‰æ›
    return ''.join(chr(int(num_str[i:i+2]) + 65)
                   for i in range(0, len(num_str), 2))

# ---- Streamlit UI ----
st.title("ğŸ” RSA æš—å·ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆä¸€äººäºŒå½¹ï¼‰")

# --- 1) éµä½œæˆãƒ‘ãƒãƒ« ---
st.header("1. éµã®ä½œæˆ")
col1, col2 = st.columns(2)

with col1:
    # ç”Ÿå¾’ã«é¸ã°ã›ã¦ã‚‚ã‚ˆã„ã—ã€è‡ªå‹•ç”Ÿæˆã‚‚å¯
    p = st.number_input("ç´ æ•° p", min_value=3, max_value=10000, value=17, step=2)
    q = st.number_input("ç´ æ•° q", min_value=3, max_value=10000, value=19, step=2)
with col2:
    e = st.number_input("å…¬é–‹éµæŒ‡æ•° e", min_value=3, max_value=1000, value=5, step=2)

if st.button("éµã‚’ä½œæˆ"):
    n = p * q
    phi = (p-1)*(q-1)
    # e ã¨ Ï†(n) ãŒäº’ã„ã«ç´ ã«ãªã‚‹ã‚ˆã†ã«
    if phi % e == 0:
        st.error("e ãŒ Ï†(n) ã¨ç´ ã§ã‚ã‚Šã¾ã›ã‚“ã€‚åˆ¥ã® e ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚")
    else:
        d = mod_inverse(e, phi)
        st.success(f"å…¬é–‹éµ (n, e) = ({n}, {e})")
        st.success(f"ç§˜å¯†éµ d = {d}")

# --- 2) æš—å·åŒ–ãƒ‘ãƒãƒ« ---
st.header("2. æš—å·åŒ–")
n_enc = st.number_input("å…¬é–‹éµ n", value=0, step=1)
e_enc = st.number_input("å…¬é–‹éµ e", value=0, step=1)
plain = st.text_input("å¹³æ–‡ï¼ˆå¤§æ–‡å­—5æ–‡å­—ã¾ã§ï¼‰", max_chars=5)

if st.button("æš—å·åŒ–", key="enc"):
    num = int(text_to_numbers(plain))
    cipher = pow(num, e_enc, n_enc)
    st.write("å¹³æ–‡â†’æ•°å€¤å¤‰æ›ï¼š", num)
    st.write("æ•°å€¤^e mod nâ†’æš—å·æ–‡ï¼š", cipher)

# --- 3) å¾©å·ãƒ‘ãƒãƒ« ---
st.header("3. å¾©å·")
n_dec = st.number_input("å…¬é–‹éµ n", value=0, step=1, key="n2")
d_dec = st.number_input("ç§˜å¯†éµ d", value=0, step=1)
cipher_in = st.text_input("æš—å·æ–‡ï¼ˆæ•°å€¤ï¼‰", value="", key="c")

if st.button("å¾©å·", key="dec"):
    plain_num = pow(int(cipher_in), d_dec, n_dec)
    result = numbers_to_text(f"{plain_num}")
    st.write("æš—å·æ–‡^d mod nâ†’å…ƒã®æ•°å€¤ï¼š", plain_num)
    st.write("æ•°å€¤â†’å¹³æ–‡ï¼š", result)